<html>
    <head>
      <script src="http://code.jquery.com/jquery-latest.js"></script>
      <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
      <script type="text/javascript" src="../jre/jvm.js"></script>

      <script type="text/javascript">
        // We are including Thread directly so we need to fake this method.
        var importScripts = function() {
        };
      </script>

      <script type="text/javascript" src="../jre/workers/Thread.js"></script>
      <script type="text/javascript" src="Object.js"></script>
      <link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
      <link rel="stylesheet" href="style.css" type="text/css" media="screen" />
  
      <script>

        
          var jvm;
          window.postMessage = function(args) {
             if (args.message) {
                 console.log(args.message);
             }
             else {
                 var e = {
                     'data' : args,
                     'target' : { 
                         'callback' : function() {},
                         'postMessage' : function(e) {
                             var data = { 'data' : e };
                             window.onmessage(data, jvm.RDA.threads[0]);
                         }
                     }
                 };
                 jvm.RDA.message(e);
             }
          };
        $(document).ready(function(){
            jvm = new JVM({
                debug : true,
                classpath : '../jre',
                path : 'classes',
                workerpath : '../jre/workers'
            });
          
              
              
        var i = 0;

          module("Opcodes", {
            
            setup : function() {
              this.frame = 0;
              (function() {
                  var t = new Thread(testObj, testObj.methods['<init>()V'], 0);
                  this.threads[0] = t;
                  window.theThread = t;
              }).call(jvm.RDA);
                            
              this.frame = {
                op_stack : new Array()
              };   
              this.run = function(arr) {
                  arr.push(177);
                  this.frame = jvm.RDA.threads[0].current_frame;
                  jvm.RDA.threads[0].current_frame.method_stack = arr;
                  jvm.RDA.threads[0].start();
              };
              this.last = function() {
                  return this.frame.op_stack.pop();
              };

              
            },
            teardown: function() {
            
            }
         });

         var opcodeTests = {
             "nop" : function() {
                 this.run([ 0 ]);
                 ok(true, "Does nothing");
             },
          
            "aconst_null" : function() {
              this.run([ 1 ]);              
              equal(this.last().pointer, 0, "Expecting null pointer on stack.");
            },
            "iconst_m1" : function() {
                this.run([ 2 ]);
                equal(this.last().val, -1, "Expecting negative 1 on stack.");
            },
            "iconst_0" : function() {
                this.run([ 3 ]);
                equal(this.last().val, 0, "Expecting 0 on stack.");
            },
            "iconst_1" : function() {
                this.run([ 4 ]);
                equal(this.last().val, 1, "Expecting 1 on stack.");
            },
            "iconst_2" : function() {
              this.run([5]);
              equal(this.last().val, 2, "Expecting 2 on stack.");
            },
            "iconst_3" : function() {
                this.run([ 6 ]);
                equal(this.last().val, 3, "Expecting 3 on stack.");
            },
            "iconst_4" : function() {
                this.run([ 7 ]);
                equal(this.last().val, 4, "Expecting 4 on stack.");
            },
            "iconst_5" : function() {
                this.run( [ 8 ]);
                equal(this.last().val, 5, "Expecting 5 on stack.");
            },
            "lconst_0" : function() {
                 this.run( [9] );
                 equal(this.last().val+this.last().val, 0, "Expecting long 0 on stack");
            },
            "lconst_1" : function() {
              this.run([ 10 ]);
              equal(this.last().val+this.last().val, 2, "Expecting long 1 on stack");
            },
            "fconst_0" : function() {
              this.run([ 11 ]);
              equal(this.last().val, 0, "Expecting float 0 on stack");
            },
            "fconst_1" : function() {
              this.run([ 12 ]);
              equal(this.last().val, 1, "Expecting float 1 on stack");
            },
            "fconst_2" : function() {
              this.run([ 13 ]);
              equal(this.last().val, 2, "Expecting float 2 on stack");
            },
            "dconst_0" : function() {
              this.run([ 14 ]);
              equal(this.last().val+this.last().val, 0, "Expecting double 0 on stack");
            },
            "dconst_1" : function() {
              this.run([ 15 ]);
              equal(this.last().val+this.last().val, 2, "Expecting double 0 on stack");
            },
            "bipush" : function() {
                this.run([ 16, 10 ]);
                equal(this.last().val, 10, "Expecting 8 bit signed int 10 on stack");
            },
            "sipush" : function() {
                this.run([ 17 , 12, 255]);
                equal(this.last().val, 3327, "Expecting 8 bit signed int 10 on stack");
            },
            "ldc" : function() {
                this.run([ 18, 2]);
                // push integer from constant pool
                this.last(); 
                equal(this.last().pointer, 1, "Expecting JVM_Reference 1 to be pushed to the stack");
            },          
            "ldc_w" : function() {
              this.run([ 19, 1, 2 ]);
              equal(this.last().val, 5, "Expecting JVM_Reference 1 to be on the stack");
            },   
            "ldc2_w" : function() {
              this.run([ 20, 1, 3]);
              equal(this.last().val, 1, "Expecting double part 1 on stack");
              equal(this.last().val, 1, "Expecting double part 2 on stack");
            },   
            "iload" : function() {
              //this.run([ 21 ]);
              ok(true, "Expecting interger on stack");
            },
            'lload' : function() {
              ok(true);
            },
            'fload' : function() {
              ok(true);
            },
            'dload' : function() {
              ok(true);
            },
            'aload' : function() {
              ok(true);
            },
            'iload_0' : function() {
              ok(true);
            },
            'iload_1' : function() {
              ok(true);
            },
            'iload_2' : function() {
              ok(true);
            },
            'iload_3' : function() {
              ok(true);
            },
            'lload_0' : function() {
              ok(true);
            },
            'lload_1' : function() {
              ok(true);
            },
            'lload_2' : function() {
              ok(true);
            },
            'lload_3' : function() {
              ok(true);
            },
            'fload_0' : function() {
              ok(true);
            },
            'fload_1' : function() {
              ok(true);
            },
            'fload_2' : function() {
              ok(true);
            },
            'fload_3' : function() {
              ok(true);
            },
            'dload_0' : function() {
              ok(true);
            },
            'dload_1' : function() {
              ok(true);
            },
            'dload_2' : function() {
              ok(true);
            },
            'dload_3' : function() {
              ok(true);
            },
            'aload_0' : function() {
              ok(true);
            },
            'aload_1' : function() {
              ok(true);
            },
            'aload_2' : function() {
              ok(true);
            },
            'aload_3' : function() {
              ok(true);
            },
            'iaload' : function() {
              ok(true);
            },
            'laload' : function() {
              ok(true);
            },
            'faload' : function() {
              ok(true);
            },
            'daload' : function() {
              ok(true);
            },
            'aaload' : function() {
              ok(true);
            },
            'baload' : function() {
              ok(true);
            },
            'caload' : function() {
              ok(true);
            },
            'saload' : function() {
              ok(true);
            },
            'istore' : function() {
              ok(true);
            },
            'lstore' : function() {
              ok(true);
            },
            'fstore' : function() {
              ok(true);
            },
            'dstore' : function() {
              ok(true);
            },
            'astore' : function() {
              ok(true);
            },
            'istore_0' : function() {
              ok(true);
            },
            'istore_1' : function() {
              ok(true);
            },
            'istore_2' : function() {
              ok(true);
            },
            'istore_3' : function() {
              ok(true);
            },
            'lstore_0' : function() {
              ok(true);
            },
            'lstore_1' : function() {
              ok(true);
            },
            'lstore_2' : function() {
              ok(true);
            },
            'lstore_3' : function() {
              ok(true);
            },
            'fstore_0' : function() {
              ok(true);
            },
            'fstore_1' : function() {
              ok(true);
            },
            'fstore_2' : function() {
              ok(true);
            },
            'fstore_3' : function() {
              ok(true);
            },
            'dstore_0' : function() {
              ok(true);
            },
            'dstore_1' : function() {
              ok(true);
            },
            'dstore_2' : function() {
              ok(true);
            },
            'dstore_3' : function() {
              ok(true);
            },
            'astore_0' : function() {
              ok(true);
            },
            'astore_1' : function() {
              ok(true);
            },
            'astore_2' : function() {
              ok(true);
            },
            'astore_3' : function() {
              ok(true);
            },
            'iastore' : function() {
              ok(true);
            },
            'lastore' : function() {
              ok(true);
            },
            'fastore' : function() {
              ok(true);
            },
            'dastore' : function() {
              ok(true);
            },
            'aastore' : function() {
              ok(true);
            },
            'bastore' : function() {
              ok(true);
            },
            'castore' : function() {
              ok(true);
            },
            'sastore' : function() {
              ok(true);
            },
            'pop' : function() {
              ok(true);
            },
            'pop2' : function() {
              ok(true);
            },
            'dup' : function() {
              ok(true);
            },
            'dup_x1' : function() {
              ok(true);
            },
            'dup_x2' : function() {
              ok(true);
            },
            'dup2' : function() {
              ok(true);
            },
            'dup2_x1' : function() {
              ok(true);
            },
            'dup2_x2' : function() {
              ok(true);
            },
            'swap' : function() {
              ok(true);
            },
            'iadd' : function() {
              ok(true);
            },
            'ladd' : function() {
              ok(true);
            },
            'fadd' : function() {
              ok(true);
            },
            'dadd' : function() {
              ok(true);
            },
            'isub' : function() {
              ok(true);
            },
            'lsub' : function() {
              ok(true);
            },
            'fsub' : function() {
              ok(true);
            },
            'dsub' : function() {
              ok(true);
            },
            'imul' : function() {
              ok(true);
            },
            'lmul' : function() {
              ok(true);
            },
            'fmul' : function() {
              ok(true);
            },
            'dmul' : function() {
              ok(true);
            },
            'idiv' : function() {
              ok(true);
            },
            'ldiv' : function() {
              ok(true);
            },
            'fdiv' : function() {
              ok(true);
            },
            'ddiv' : function() {
              ok(true);
            },
            'irem' : function() {
              ok(true);
            },
            'lrem' : function() {
              ok(true);
            },
            'frem' : function() {
              ok(true);
            },
            'drem' : function() {
              ok(true);
            },
            'ineg' : function() {
              ok(true);
            },
            'lneg' : function() {
              ok(true);
            },
            'fneg' : function() {
              ok(true);
            },
            'dneg' : function() {
              ok(true);
            },
            'ishl' : function() {
              ok(true);
            },
            'lshl' : function() {
              ok(true);
            },
            'ishr' : function() {
              ok(true);
            },
            'lshr' : function() {
              ok(true);
            },
            'iushr' : function() {
              ok(true);
            },
            'lushr' : function() {
              ok(true);
            },
            'iand' : function() {
              ok(true);
            },
            'land' : function() {
              ok(true);
            },
            'ior' : function() {
              ok(true);
            },
            'lor' : function() {
              ok(true);
            },
            'ixor' : function() {
              ok(true);
            },
            'lxor' : function() {
              ok(true);
            },
            'iinc' : function() {
              ok(true);
            },
            'i2l' : function() {
              ok(true);
            },
            'i2f' : function() {
              ok(true);
            },
            'i2d' : function() {
              ok(true);
            },
            'l2f' : function() {
              ok(true);
            },
            'l2f' : function() {
              ok(true);
            },
            'l2d' : function() {
              ok(true);
            },
            'f2i' : function() {
              ok(true);
            },
            'f2l' : function() {
              ok(true);
            },
            'f2d' : function() {
              ok(true);
            },
            'd2i' : function() {
              ok(true);
            },
            'd2l' : function() {
              ok(true);
            },
            'd2f' : function() {
              ok(true);
            },
            'i2b' : function() {
              ok(true);
            },
            'i2c' : function() {
              ok(true);
            },
            'i2s' : function() {
              ok(true);
            },
            'lcmp' : function() {
              ok(true);
            },
            'fcmpl' : function() {
              ok(true);
            },
            'fcmpg' : function() {
              ok(true);
            },
            'dcmpl' : function() {
              ok(true);
            },
            'dcmpg' : function() {
              ok(true);
            },
            'ifeq' : function() {
              ok(true);
            },
            'ifne' : function() {
              ok(true);
            },
            'iflt' : function() {
              ok(true);
            },
            'ifge' : function() {
              ok(true);
            },
            'ifgt' : function() {
              ok(true);
            },
            'ifle' : function() {
              ok(true);
            },
            'if_icmpeq' : function() {
              ok(true);
            },
            'if_acmpne' : function() {
              ok(true);
            },
            'if_icmplt' : function() {
              ok(true);
            },
            'if_icmpge' : function() {
              ok(true);
            },
            'if_icmpgt' : function() {
              ok(true);
            },
            'if_icmple' : function() {
              ok(true);
            },
            'if_acmpeq' : function() {
              ok(true);
            },
            'if_acmpne' : function() {
              ok(true);
            },
            'goto' : function() {
              ok(true);
            },
            'jsr' : function() {
              ok(true);
            },
            'ret' : function() {
              ok(true);
            },
            'tableswitch' : function() {
              ok(false);
            },
            'lookupswitch' : function() {
              ok(false);
            },
            'ireturn' : function() {
              ok(true);
            },
            'lreturn' : function() {
              ok(true);
            },
            'freturn' : function() {
              ok(true);
            },
            'dreturn' : function() {
              ok(true);
            },
            'areturn' : function() {
              ok(true);
            },
            'return' : function() {
              ok(true);
            },
            'getstatic' : function() {
              ok(true);
            },
            'putstatic' : function() {
              ok(true);
            },
            'getfield' : function() {
              ok(true);
            },
            'putfield' : function() {
              ok(true);
            },
            'invokevirtual' : function() {
              ok(true);
            },
            'invokespecial' : function() {
              ok(true);
            },
            'invokestatic' : function() {
              ok(true);
            },
            'invokeinterface' : function() {
              ok(true);
            },
            'unused' : function() {
              ok(true);
            },
            'new' : function() {
              ok(true);
            },
            'newarray' : function() {
              ok(true);
            },
            'anewarray' : function() {
              ok(true);
            },
            'arraylength' : function() {
              ok(true);
            },
            'athrow' : function() {
              ok(true);
            },
            'checkcast' : function() {
              ok(true);
            },
            'instanceof' : function() {
              ok(true);
            },
            'monitorenter' : function() {
              ok(true);
            },
            'monitorexit' : function() {
              ok(true);
            },
            'wide' : function() {
              ok(true);
            },
            'multianewarray' : function() {
              ok(true);
            },
            'ifnull' : function() {
              ok(true);
            },
            'ifnonnull' : function() {
              ok(true);
            },
            'goto_w' : function() {
              ok(true);
            },
            'jsr_w' : function() {
              ok(true);
            },
            'breakpoint' : function() {
              ok(true);
            }
           
         };


         
         for(op in opcodeTests) {
            
            test(op, opcodeTests[op]);
           
         };
          
        });
      </script>
  
</head>
  <body>
    <h1 id="qunit-header">jsJVM Test Suite</h1>
    <h2 id="qunit-banner"></h2>
    <div id="description">Tests to determine the speed and accuracy of the
        jsJVM OpCodes.
        Testing...</div>
   <div id="qunit-testrunner-toolbar"></div>
   <h2 id="qunit-userAgent"></h2>
   <ol id="qunit-tests"></ol>
   <div id="qunit-fixture">test markup, will be hidden</div>
  </body>
</html>
